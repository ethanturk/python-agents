http:
  # Routers
  routers:
    # ===== Southhaven App =====

    # Southhaven Frontend
    southhaven-frontend:
      rule: "Host(`aidocs.ethanturk.com`) && PathPrefix(`/southhaven/`)"
      entryPoints:
        - websecure
      service: southhaven-frontend-service
      tls:
        certResolver: letsencrypt
      priority: 10

    # Southhaven Backend API
    southhaven-backend:
      rule: "Host(`aidocs.ethanturk.com`) && PathPrefix(`/southhaven/agent/`)"
      entryPoints:
        - websecure
      service: southhaven-backend-service
      middlewares:
        - southhaven-stripprefix
      tls:
        certResolver: letsencrypt
      priority: 20

    # Southhaven WebSocket
    southhaven-websocket:
      rule: "Host(`aidocs.ethanturk.com`) && PathPrefix(`/southhaven/ws`)"
      entryPoints:
        - websecure
      service: southhaven-backend-service
      middlewares:
        - southhaven-stripprefix
      tls:
        certResolver: letsencrypt
      priority: 30

    # ===== Demo App =====

    # Demo Frontend
    demo-frontend:
      rule: "Host(`aidocs.ethanturk.com`) && PathPrefix(`/demo/`)"
      entryPoints:
        - websecure
      service: demo-frontend-service
      tls:
        certResolver: letsencrypt
      priority: 10

    # Demo Backend API
    demo-backend:
      rule: "Host(`aidocs.ethanturk.com`) && PathPrefix(`/demo/agent/`)"
      entryPoints:
        - websecure
      service: demo-backend-service
      middlewares:
        - demo-stripprefix
      tls:
        certResolver: letsencrypt
      priority: 20

    # Demo WebSocket
    demo-websocket:
      rule: "Host(`aidocs.ethanturk.com`) && PathPrefix(`/demo/ws`)"
      entryPoints:
        - websecure
      service: demo-backend-service
      middlewares:
        - demo-stripprefix
      tls:
        certResolver: letsencrypt
      priority: 30

  # Services
  services:
    # Southhaven Services
    southhaven-frontend-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:3001"
        passHostHeader: true

    southhaven-backend-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:9998"
        passHostHeader: true

    # Demo Services
    demo-frontend-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:3002"
        passHostHeader: true

    demo-backend-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:9997"
        passHostHeader: true

  # Middlewares
  middlewares:
    # Strip /southhaven prefix for backend requests
    southhaven-stripprefix:
      stripPrefix:
        prefixes:
          - "/southhaven"
        forceSlash: false

    # Strip /demo prefix for backend requests
    demo-stripprefix:
      stripPrefix:
        prefixes:
          - "/demo"
        forceSlash: false
